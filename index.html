code
Html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Everything You Want - è®“æ„›å¾ªç’°</title>
    
    <!-- å¼•å…¥å­—é«”èˆ‡åœ–ç¤º -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS (å¿«é€Ÿæ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Firebase SDK (ç”¨æ–¼å¤šäººé€£ç·š) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- æ…¶ç¥ç‰¹æ•ˆ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --warm-bg: linear-gradient(120deg, #fccb90 0%, #d57eeb 100%);
            --glass: rgba(255, 255, 255, 0.85);
            --primary: #FF80AB;
            --secondary: #4DD0E1;
        }

        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-image: var(--warm-bg);
            background-attachment: fixed;
            min-height: 100vh;
            color: #444;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯æµå‹•å‹•ç•« */
        .bg-bubbles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .bg-bubbles li {
            position: absolute;
            list-style: none;
            display: block;
            width: 40px; height: 40px;
            background-color: rgba(255, 255, 255, 0.3);
            bottom: -150px;
            animation: square 25s infinite;
            border-radius: 50%;
        }
        .bg-bubbles li:nth-child(1) { left: 10%; width: 80px; height: 80px; animation-delay: 0s; }
        .bg-bubbles li:nth-child(2) { left: 20%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .bg-bubbles li:nth-child(3) { left: 25%; width: 20px; height: 20px; animation-delay: 4s; }
        .bg-bubbles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .bg-bubbles li:nth-child(5) { left: 70%; width: 20px; height: 20px; animation-delay: 0s; }
        .bg-bubbles li:nth-child(6) { left: 80%; width: 120px; height: 120px; animation-delay: 3s; background-color: rgba(255, 255, 255, 0.2); }
        .bg-bubbles li:nth-child(7) { left: 32%; width: 160px; height: 160px; animation-delay: 7s; }
        
        @keyframes square {
            0% { transform: translateY(0); }
            100% { transform: translateY(-1200px) rotate(600deg); }
        }

        /* ç»ç’ƒæ“¬æ…‹å¡ç‰‡ */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            transition: all 0.3s ease;
        }
        .glass-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.15); }

        .btn-shine {
            position: relative;
            overflow: hidden;
        }
        .btn-shine::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
            transform: rotate(45deg);
            transition: all 0.3s;
            opacity: 0;
        }
        .btn-shine:hover::after { left: 100%; top: 100%; opacity: 1; transition: 0.7s; }

        /* äº’å‹•ç‰¹æ•ˆ */
        .heart-beat { animation: heartbeat 1.5s infinite; }
        @keyframes heartbeat { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        [v-cloak] { display: none; }
    </style>
</head>
<body>

<!-- èƒŒæ™¯æ³¡æ³¡å‹•ç•« -->
<ul class="bg-bubbles">
    <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
</ul>

<div id="app" v-cloak class="relative z-10 pb-20">
    
    <!-- é ‚éƒ¨å°èˆª -->
    <header class="glass-card sticky top-0 z-50 m-4 p-4 flex justify-between items-center rounded-2xl">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-tr from-pink-400 to-purple-400 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg">G</div>
            <div>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-purple-600">Get Everything You Want</h1>
                <p class="text-xs text-gray-500">Buy nothing, get everything.</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button @click="scrollTo('rules')" class="px-4 py-2 rounded-full text-sm hover:bg-white/50 transition"><i class="fas fa-book mr-1"></i>é»˜å¥‘</button>
            <button @click="checkAdmin" class="px-4 py-2 rounded-full text-sm hover:bg-white/50 transition" :class="{'bg-red-100 text-red-500': isAdmin}"><i class="fas fa-user-shield mr-1"></i>{{ isAdmin ? 'ç®¡ç†å“¡' : 'ç™»å…¥' }}</button>
        </div>
    </header>

    <!-- ä¸»è¦–è¦ºå€ -->
    <div class="container mx-auto px-4 mt-8 text-center">
        <h2 class="text-3xl md:text-5xl font-bold text-white drop-shadow-md mb-4 leading-tight">
            èª å¿ƒè¨±ä¸‹é¡˜æœ›<br>æ¨‚æ–¼å›æ‡‰éœ€æ±‚
        </h2>
        <p class="text-white text-lg drop-shadow mb-8 opacity-90">
            é€™è£¡æ²’æœ‰äº¤æ˜“ï¼Œåªæœ‰æº«æš–çš„å‚³éã€‚<br>
            #å…è²» #å…±äº« #äº’åˆ© #ç¶ è‰²ç”Ÿæ´»
        </p>
        
        <div class="flex justify-center gap-6 mb-12">
            <button @click="openPostModal('wish')" class="btn-shine bg-white text-blue-500 px-8 py-4 rounded-full font-bold shadow-lg transform hover:scale-105 transition flex items-center gap-2 border-2 border-blue-100">
                <i class="fas fa-praying-hands text-xl"></i> æˆ‘è¦è¨±é¡˜ (è¨±é¡˜æ± )
            </button>
            <button @click="openPostModal('give')" class="btn-shine bg-gradient-to-r from-pink-400 to-red-400 text-white px-8 py-4 rounded-full font-bold shadow-lg transform hover:scale-105 transition flex items-center gap-2">
                <i class="fas fa-gift text-xl"></i> æˆ‘è¦è²¢ç» (ç›Šç¦ç”°)
            </button>
        </div>

        <!-- ç³»çµ±ç‹€æ…‹æç¤º -->
        <div v-if="!isOnline" class="inline-block bg-yellow-100 text-yellow-800 px-4 py-1 rounded-full text-xs font-bold mb-4 border border-yellow-300">
            <i class="fas fa-wifi-slash mr-1"></i> ç›®å‰ç‚ºå–®æ©Ÿé è¦½æ¨¡å¼ã€‚ç®¡ç†å“¡è«‹ç™»å…¥è¨­å®šé€£ç·šé‡‘é‘°ä»¥é–‹å•Ÿå¤šäººå³æ™‚åŠŸèƒ½ã€‚
        </div>
        <div v-else class="inline-block bg-green-100 text-green-800 px-4 py-1 rounded-full text-xs font-bold mb-4 border border-green-300">
            <i class="fas fa-wifi mr-1"></i> å¤šäººé€£ç·šä¸­ ({{ posts.length }} å‰‡è²¼æ–‡)
        </div>
    </div>

    <!-- å®ˆå‰‡å€ -->
    <div id="rules" class="container mx-auto px-4 mb-10">
        <div class="glass-card p-6 cursor-pointer" @click="showRules = !showRules">
            <h3 class="font-bold text-gray-700 flex justify-between items-center">
                <span><i class="fas fa-heart text-pink-400 mr-2"></i> å¹³å°ä½¿ç”¨å®ˆå‰‡èˆ‡é»˜å¥‘</span>
                <i class="fas" :class="showRules ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
            </h3>
            <div v-if="showRules" class="mt-4 text-sm text-gray-600 space-y-2 border-t pt-4 border-gray-200">
                <p>1. <strong>å¯¦ååˆ¶ï¼š</strong> è«‹ä½¿ç”¨çœŸå¯¦å§“å (ç­ç´š/åº§è™Ÿ/å§“å)ï¼Œå»ºç«‹ä¿¡ä»»ã€‚</p>
                <p>2. <strong>å–®ä¸€ç‰©ä»¶ï¼š</strong> æ¯æ¬¡è²¼æ–‡é™ä¸€å€‹ç‰©ä»¶ï¼Œæ¸…æ¥šèªªæ˜ç†ç”±ã€‚</p>
                <p>3. <strong>å¥åº·å®‰å…¨ï¼š</strong> åš´ç¦å±éšªæˆ–ä¸è¡›ç”Ÿç‰©ä»¶ï¼Œå¿…é ˆæœ‰ç›Šèº«å¿ƒï¼</p>
                <p>4. <strong>ç„¡åƒ¹ä¹‹å¯¶ï¼š</strong> ç¦æ­¢é‡‘éŒ¢äº¤æ˜“ï¼Œé€™æ˜¯ç¦®ç‰©ç¶“æ¿Ÿçš„å¯¦è¸ã€‚</p>
            </div>
        </div>
    </div>

    <!-- å…©æ¬„å…§å®¹æµ -->
    <div class="container mx-auto px-4 grid md:grid-cols-2 gap-8">
        
        <!-- è¨±é¡˜æ±  -->
        <div>
            <div class="flex items-center justify-center mb-4 text-blue-600 bg-blue-50 py-2 rounded-xl">
                <h3 class="text-xl font-bold"><i class="fas fa-star mr-2 text-yellow-400"></i>è¨±é¡˜æ± </h3>
            </div>
            
            <div v-if="wishPosts.length === 0" class="text-center text-gray-400 py-10">ç›®å‰æ²’æœ‰é¡˜æœ›ï¼Œå¿«ä¾†è¨±é¡˜å§ï¼</div>

            <div v-for="post in wishPosts" :key="post.id" class="glass-card p-5 mb-5 relative group">
                <!-- ç®¡ç†å“¡åˆªé™¤éˆ• -->
                <button v-if="isAdmin" @click="deletePost(post.id)" class="absolute top-2 right-2 bg-red-100 text-red-500 w-8 h-8 rounded-full hover:bg-red-500 hover:text-white transition z-20">
                    <i class="fas fa-trash-alt"></i>
                </button>

                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-500 font-bold">
                        {{ post.name.charAt(post.name.length-1) }}
                    </div>
                    <div>
                        <div class="font-bold text-gray-700 text-sm">{{ post.name }}</div>
                        <div class="text-xs text-gray-400">{{ formatDate(post.date) }}</div>
                    </div>
                    <span v-if="post.status === 'matched'" class="ml-auto bg-green-100 text-green-600 px-2 py-1 rounded-lg text-xs font-bold">å·²åœ“æ»¿</span>
                </div>

                <h4 class="text-lg font-bold text-blue-600 mb-2">{{ post.item }}</h4>
                <p class="text-gray-600 text-sm mb-4 bg-white/50 p-3 rounded-lg">{{ post.desc }}</p>

                <div class="flex items-center justify-between mt-4 pt-3 border-t border-gray-100">
                    <button @click="likePost(post)" class="text-pink-400 hover:text-pink-600 transition flex items-center gap-1">
                        <i class="far fa-heart"></i> {{ post.likes || 0 }} é›†æ°£
                    </button>
                    <button v-if="post.status !== 'matched'" @click="startMatch(post)" class="bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-bold shadow-md hover:bg-blue-600 transition">
                        ğŸ™‹ æˆ‘èƒ½å¹«å¿™
                    </button>
                    <div v-else class="text-green-500 font-bold text-sm"><i class="fas fa-check-circle"></i> æ„Ÿè¬æœ‰ä½ </div>
                </div>

                <!-- ç•™è¨€é¡¯ç¤ºå€ (ç°¡åŒ–ç‰ˆ) -->
                <div v-if="post.comments && post.comments.length > 0" class="mt-3 bg-gray-50 rounded-lg p-3 text-xs space-y-2">
                    <div v-for="(comment, idx) in post.comments" :key="idx" class="border-l-2 border-blue-300 pl-2">
                        <span class="font-bold text-gray-600">{{ comment.user }}:</span> {{ comment.text }}
                    </div>
                </div>
            </div>
        </div>

        <!-- ç›Šç¦ç”° -->
        <div>
            <div class="flex items-center justify-center mb-4 text-pink-600 bg-pink-50 py-2 rounded-xl">
                <h3 class="text-xl font-bold"><i class="fas fa-seedling mr-2 text-green-500"></i>ç›Šç¦ç”°</h3>
            </div>

            <div v-if="givePosts.length === 0" class="text-center text-gray-400 py-10">ç›®å‰æ²’æœ‰è²¢ç»ï¼ŒæœŸå¾…ä½ çš„å–„æ„ï¼</div>

            <div v-for="post in givePosts" :key="post.id" class="glass-card p-5 mb-5 relative group border-l-4 border-pink-400">
                <button v-if="isAdmin" @click="deletePost(post.id)" class="absolute top-2 right-2 bg-red-100 text-red-500 w-8 h-8 rounded-full hover:bg-red-500 hover:text-white transition z-20">
                    <i class="fas fa-trash-alt"></i>
                </button>

                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-pink-100 flex items-center justify-center text-pink-500 font-bold">
                        {{ post.name.charAt(post.name.length-1) }}
                    </div>
                    <div>
                        <div class="font-bold text-gray-700 text-sm">{{ post.name }}</div>
                        <div class="text-xs text-gray-400">{{ formatDate(post.date) }}</div>
                    </div>
                    <span v-if="post.status === 'matched'" class="ml-auto bg-green-100 text-green-600 px-2 py-1 rounded-lg text-xs font-bold">å·²åœ“æ»¿</span>
                </div>

                <h4 class="text-lg font-bold text-pink-500 mb-2">{{ post.item }}</h4>
                <p class="text-gray-600 text-sm mb-4 bg-white/50 p-3 rounded-lg">{{ post.desc }}</p>

                <div class="flex items-center justify-between mt-4 pt-3 border-t border-gray-100">
                    <button @click="likePost(post)" class="text-pink-400 hover:text-pink-600 transition flex items-center gap-1">
                        <i class="far fa-heart"></i> {{ post.likes || 0 }} æ„Ÿè¬
                    </button>
                    <button v-if="post.status !== 'matched'" @click="startMatch(post)" class="bg-pink-500 text-white px-4 py-2 rounded-full text-sm font-bold shadow-md hover:bg-pink-600 transition">
                        ğŸ æˆ‘éœ€è¦é€™å€‹
                    </button>
                    <div v-else class="text-green-500 font-bold text-sm"><i class="fas fa-check-circle"></i> æ„Ÿè¬åˆ†äº«</div>
                </div>

                <div v-if="post.comments && post.comments.length > 0" class="mt-3 bg-gray-50 rounded-lg p-3 text-xs space-y-2">
                    <div v-for="(comment, idx) in post.comments" :key="idx" class="border-l-2 border-pink-300 pl-2">
                        <span class="font-bold text-gray-600">{{ comment.user }}:</span> {{ comment.text }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™¼æ–‡ Modal -->
    <div v-if="showModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-2xl animate-[fadeIn_0.3s_ease-out]">
            <div class="p-4 bg-gradient-to-r text-white font-bold text-lg flex justify-between items-center" 
                 :class="postType === 'wish' ? 'from-blue-400 to-cyan-400' : 'from-pink-400 to-orange-400'">
                <span>{{ postType === 'wish' ? 'ğŸ™ è¨±ä¸‹ä½ çš„é¡˜æœ›' : 'ğŸ åˆ†äº«ä½ çš„å–„æ„' }}</span>
                <button @click="showModal = false" class="hover:bg-white/20 rounded-full w-8 h-8"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-500 mb-1">æˆ‘æ˜¯èª° (ç­ç´š/åº§è™Ÿ/å§“å)</label>
                    <input v-model="newPost.name" class="w-full border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:border-blue-400 transition" placeholder="ä¾‹å¦‚ï¼šè­·ç†äºŒç”² 05è™Ÿ æ—å°ç¾">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-500 mb-1">{{ postType === 'wish' ? 'æˆ‘éœ€è¦çš„ç‰©å“/æœå‹™' : 'æˆ‘æä¾›çš„ç‰©å“/æœå‹™' }}</label>
                    <input v-model="newPost.item" class="w-full border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:border-blue-400 transition" placeholder="è«‹æ¸…æ¥šå¡«å¯«åç¨±">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-500 mb-1">{{ postType === 'wish' ? 'éœ€æ±‚ç†ç”±èˆ‡ç¨‹åº¦' : 'ç‰©ä»¶ç‹€æ³èˆ‡è²¢ç»ç·£ç”±' }}</label>
                    <textarea v-model="newPost.desc" rows="3" class="w-full border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:border-blue-400 transition" placeholder="å¤šä¸€é»æè¿°ï¼Œå¤šä¸€ä»½æº«æš–..."></textarea>
                </div>
                <button @click="submitPost" class="w-full py-3 rounded-xl text-white font-bold shadow-md transform active:scale-95 transition"
                    :class="postType === 'wish' ? 'bg-blue-500 hover:bg-blue-600' : 'bg-pink-500 hover:bg-pink-600'">
                    ç™¼å¸ƒè²¼æ–‡
                </button>
            </div>
        </div>
    </div>

    <!-- åª’åˆ/ç•™è¨€ Modal -->
    <div v-if="matchModal.show" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm text-center p-6 shadow-2xl relative">
            <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-white p-2 rounded-full shadow-lg">
                <i class="fas fa-hand-holding-heart text-4xl text-pink-500"></i>
            </div>
            <h3 class="mt-8 text-2xl font-bold text-gray-700">å¤ªæ£’äº†ï¼</h3>
            <p class="text-gray-500 my-2">ä½ çš„å–„æ„å°‡å‰µé€ ä¸€å€‹ç¾å¥½çš„é€£çµã€‚</p>
            <div class="bg-yellow-50 p-3 rounded-lg text-left text-sm text-yellow-700 mb-4">
                <strong>ğŸ’¡ æº«é¦¨æé†’ï¼š</strong><br>è«‹åœ¨ä¸‹æ–¹ç•™è¨€å‘ŠçŸ¥å¦‚ä½•è¯ç¹«æˆ–é¢äº¤åœ°é»ã€‚æ³¨æ„ç¦®è²Œèˆ‡å®‰å…¨å–”ï¼
            </div>
            <textarea v-model="matchComment" class="w-full border p-2 rounded-lg mb-4" placeholder="ä¾‹å¦‚ï¼šæˆ‘æœ‰é€™å€‹æ±è¥¿ï¼æ˜å¤©ä¸­åˆå¯ä»¥æ‹¿åˆ°æ•™å®¤çµ¦ä½ ..."></textarea>
            <div class="flex gap-2">
                <button @click="matchModal.show = false" class="flex-1 py-2 border rounded-lg text-gray-500">å†æƒ³æƒ³</button>
                <button @click="confirmMatch" class="flex-1 py-2 bg-pink-500 text-white rounded-lg font-bold">é€å‡ºç•™è¨€</button>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†å“¡è¨­å®š Modal -->
    <div v-if="showAdminConfig" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-900 text-white rounded-xl max-w-lg w-full p-6 border border-gray-700">
            <h3 class="text-xl font-bold mb-4 text-green-400"><i class="fas fa-terminal mr-2"></i>ç³»çµ±æ ¸å¿ƒè¨­å®š</h3>
            <p class="text-sm text-gray-400 mb-4">
                è‹¥è¦å•Ÿç”¨ã€ŒçœŸæ­£çš„ç¶²è·¯å¤šäººé€£ç·šã€ï¼Œè«‹åœ¨ä¸‹æ–¹è²¼ä¸Š Firebase Config ä»£ç¢¼ã€‚<br>
                (è‹¥ç‚ºç©ºï¼Œç³»çµ±å°‡ä½¿ç”¨ LocalStorage å–®æ©Ÿæ¨¡æ“¬æ¨¡å¼)
            </p>
            <textarea v-model="firebaseConfigStr" rows="10" class="w-full bg-black border border-gray-600 text-green-500 font-mono text-xs p-3 rounded focus:outline-none mb-4" placeholder='Paste your firebaseConfig object here... ex: { apiKey: "...", ... }'></textarea>
            <div class="flex justify-end gap-3">
                <button @click="showAdminConfig = false" class="px-4 py-2 text-gray-400 hover:text-white">é—œé–‰</button>
                <button @click="saveConfig" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded font-bold">å„²å­˜ä¸¦é‡å•Ÿ</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- ç‹€æ…‹è®Šæ•¸ ---
            const posts = ref([]);
            const showRules = ref(false);
            const showModal = ref(false);
            const showAdminConfig = ref(false);
            const postType = ref('wish');
            const isAdmin = ref(false);
            const isOnline = ref(false);
            
            const newPost = ref({ name: '', item: '', desc: '' });
            
            const matchModal = ref({ show: false, post: null });
            const matchComment = ref('');
            const firebaseConfigStr = ref('');

            // --- è¨ˆç®—å±¬æ€§ ---
            const wishPosts = computed(() => posts.value.filter(p => p.type === 'wish').sort((a,b) => b.id - a.id));
            const givePosts = computed(() => posts.value.filter(p => p.type === 'give').sort((a,b) => b.id - a.id));

            // --- è³‡æ–™åº«é‚è¼¯ (Firebase + LocalStorage Fallback) ---
            let db = null;

            const initDB = () => {
                const savedConfig = localStorage.getItem('site_firebase_config');
                
                if (savedConfig && savedConfig.trim().startsWith('{')) {
                    // å˜—è©¦é€£æ¥ Firebase
                    try {
                        // ä½¿ç”¨ eval è§£æå­—ä¸² (åƒ…é™ç®¡ç†å“¡è¼¸å…¥ï¼Œé¢¨éšªå¯æ§)
                        const config = eval(`(${savedConfig})`);
                        if (!firebase.apps.length) {
                            firebase.initializeApp(config);
                        }
                        db = firebase.firestore();
                        isOnline.value = true;
                        
                        // ç›£è½ Firebase æ•¸æ“š
                        db.collection('posts').onSnapshot(snapshot => {
                            posts.value = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        });
                        firebaseConfigStr.value = savedConfig;
                        console.log("Firebase Connected");
                        return;
                    } catch (e) {
                        console.error("Firebase Config Error", e);
                        alert("Firebase è¨­å®šæ ¼å¼æœ‰èª¤ï¼Œå·²åˆ‡æ›å›å–®æ©Ÿæ¨¡å¼");
                    }
                }

                // é™ç´šåˆ°å–®æ©Ÿæ¨¡å¼ (LocalStorage)
                isOnline.value = false;
                const localData = localStorage.getItem('site_posts');
                if (localData) {
                    posts.value = JSON.parse(localData);
                } else {
                    // é è¨­ç¤ºç¯„è³‡æ–™
                    posts.value = [
                        { id: 1700000001, type: 'wish', name: 'è­·ç†äºŒç”² 01è™Ÿ ç¤ºç¯„ç”Ÿ', item: 'è§£å‰–å­¸ç­†è¨˜', desc: 'é€™æ˜¯ä¸€å€‹ç¯„ä¾‹é¡˜æœ›ï¼Œå¸Œæœ›èƒ½å¾µæ±‚å­¸é•·å§çš„ç­†è¨˜ï¼', date: new Date().toISOString(), likes: 2, status: 'active', comments: [] },
                        { id: 1700000002, type: 'give', name: 'é¤é£²ä¸€ä¹™ 10è™Ÿ å¤§æ–¹å“¥', item: 'å…¨æ–°æ–‡å…·çµ„', desc: 'åƒåŠ æ¯”è³½æ‹¿åˆ°çš„çå“ï¼Œä½†æˆ‘å·²ç¶“æœ‰äº†ï¼Œåˆ†äº«çµ¦éœ€è¦çš„äººã€‚', date: new Date().toISOString(), likes: 5, status: 'active', comments: [] }
                    ];
                }
            };

            // å„²å­˜è³‡æ–™ (æ ¹æ“šæ¨¡å¼)
            const saveData = async (action, payload) => {
                if (isOnline.value && db) {
                    if (action === 'add') {
                        await db.collection('posts').doc(String(payload.id)).set(payload);
                    } else if (action === 'delete') {
                        await db.collection('posts').doc(String(payload)).delete();
                    } else if (action === 'update') {
                        await db.collection('posts').doc(String(payload.id)).update(payload);
                    }
                } else {
                    // å–®æ©Ÿæ¨¡å¼
                    if (action === 'add') posts.value.unshift(payload);
                    if (action === 'delete') posts.value = posts.value.filter(p => p.id !== payload);
                    if (action === 'update') {
                        const idx = posts.value.findIndex(p => p.id === payload.id);
                        if (idx !== -1) posts.value[idx] = payload;
                    }
                    localStorage.setItem('site_posts', JSON.stringify(posts.value));
                }
            };

            // --- åŠŸèƒ½å‡½æ•¸ ---

            const openPostModal = (type) => {
                postType.value = type;
                showModal.value = true;
            };

            const submitPost = () => {
                if (!newPost.value.name || !newPost.value.item || !newPost.value.desc) {
                    alert('è«‹å°‡æ¬„ä½å¡«å¯«å®Œæ•´å–”ï¼');
                    return;
                }
                const post = {
                    id: Date.now(),
                    type: postType.value,
                    ...newPost.value,
                    date: new Date().toISOString(),
                    likes: 0,
                    status: 'active',
                    comments: []
                };
                saveData('add', post);
                showModal.value = false;
                newPost.value = { name: '', item: '', desc: '' };
                triggerConfetti(0.5);
            };

            const deletePost = (id) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡è²¼æ–‡å—ï¼Ÿ')) {
                    saveData('delete', id);
                }
            };

            const likePost = (post) => {
                const updatedPost = { ...post, likes: (post.likes || 0) + 1 };
                saveData('update', updatedPost);
            };

            const startMatch = (post) => {
                matchModal.value.post = post;
                matchModal.value.show = true;
            };

            const confirmMatch = () => {
                if (!matchComment.value) return;
                const post = matchModal.value.post;
                
                // æ–°å¢ç•™è¨€ä¸¦æ¨™è¨˜å¯èƒ½å·²åª’åˆ (é€™è£¡åªåšç•™è¨€ï¼Œç‹€æ…‹ç”±åŸpoæ±ºå®šæˆ–è¦–ç‚ºæºé€šä¸­)
                const newComment = {
                    user: 'ç†±å¿ƒåŒå­¸', // å¯¦éš›æ‡‰ç”¨å¯è¦æ±‚è¼¸å…¥åå­—
                    text: matchComment.value,
                    date: new Date().toISOString()
                };
                
                const updatedComments = post.comments ? [...post.comments, newComment] : [newComment];
                // ç‚ºäº†ç°¡å–®æ¼”ç¤ºï¼Œä¸€æ—¦æœ‰äººæ¥æ´½ï¼Œæˆ‘å€‘å°‡ç‹€æ…‹æ”¹ç‚º 'contacting' (é€™è£¡ç°¡å–®é¡¯ç¤ºå·²åœ“æ»¿)
                // å¯¦å‹™ä¸Šæ‡‰è©²è¦æœ‰æ›´è¤‡é›œçš„ç‹€æ…‹æ©Ÿï¼Œä½†é«˜ä¸­å°ˆé¡Œé©åˆç°¡å–®åŒ–ï¼šæœ‰äººç•™è¨€ = åª’åˆæˆåŠŸ
                
                const updatedPost = { 
                    ...post, 
                    comments: updatedComments,
                    status: 'matched' // ç°¡å–®èµ·è¦‹ï¼Œæœ‰äººæ¥æ´½ç›´æ¥æ¨™ç¤ºåœ“æ»¿ï¼Œæ¿€å‹µäººå¿ƒ
                };

                saveData('update', updatedPost);
                
                matchModal.value.show = false;
                matchComment.value = '';
                matchModal.value.post = null;
                
                // æ’­æ”¾è¶…å¤§æ…¶ç¥ç‰¹æ•ˆ
                triggerConfetti(0.3);
                setTimeout(() => triggerConfetti(0.7), 400);
            };

            const checkAdmin = () => {
                if (isAdmin.value) {
                    // å·²ç™»å…¥ç‹€æ…‹é»æ“Š -> é–‹å•Ÿè¨­å®š
                    showAdminConfig.value = true;
                    return;
                }
                const pwd = prompt("è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ï¼š");
                if (pwd === "admin888") {
                    isAdmin.value = true;
                    alert("æ­¡è¿å›ä¾†ï¼Œè€å¸«ï¼é»æ“Šã€Œç®¡ç†å“¡ã€æŒ‰éˆ•å¯è¨­å®šè³‡æ–™åº«é€£ç·šã€‚");
                } else if(pwd) {
                    alert("å¯†ç¢¼éŒ¯èª¤");
                }
            };

            const saveConfig = () => {
                localStorage.setItem('site_firebase_config', firebaseConfigStr.value);
                location.reload(); // é‡æ•´ä»¥å¥—ç”¨
            };

            const formatDate = (isoStr) => {
                const d = new Date(isoStr);
                return `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${d.getMinutes().toString().padStart(2,'0')}`;
            };

            const triggerConfetti = (originX) => {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6, x: originX },
                    colors: ['#FF80AB', '#4DD0E1', '#FFD54F']
                });
            };

            // ç”Ÿå‘½é€±æœŸ
            onMounted(() => {
                initDB();
            });

            return {
                posts, wishPosts, givePosts,
                showRules, showModal, matchModal, showAdminConfig,
                postType, isAdmin, isOnline,
                newPost, matchComment, firebaseConfigStr,
                openPostModal, submitPost, deletePost, likePost,
                startMatch, confirmMatch, checkAdmin, saveConfig,
                formatDate
            };
        }
    }).mount('#app');
</script>
</body>
</html>